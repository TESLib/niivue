<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>Line Component with Model</title>
    <link rel="stylesheet" href="light.css" />
</head>
<body>
    <noscript>niivue requires JavaScript.</noscript>
    <header></header>
    <main>
        <canvas id="gl1"></canvas>
    </main>
    <script type="module" async>
        import * as niivue from "../dist/index.js";

        async function drawModelLines() {
            const textColor = [1.0, 1.0, 1.0, 1.0];
            const outlineColor = [1, 1, 1, 1];
            const fillColor = [0, 0, 0, 0.3];
            const lineColor = [0.529, 0.808, 0.980, 1.0]; // Light blue color
            const scale = 0.5;
            const margin = 15;
            const roundness = 0.3;

            // TextBoxComponent setup
            const labelText = new niivue.TextBoxComponent({
                font: nv1.defaultFont,
                position: [nv1.canvas.width - 150, nv1.canvas.height / 2],
                text: "Hippocampus",
                textColor: textColor,
                outlineColor: lineColor,
                fillColor: fillColor,
                margin: margin,
                roundness: roundness,
                scale: scale,
                maxWidth: 0,
                fontOutlineColor: [0, 0, 0, 1],
                fontOutlineThickness: 1,
            });
            labelText.alignmentPoint = niivue.UIKit.alignmentPoint.MIDDLERIGHT;
            ui.addComponent(labelText);

            // Model point in 3D space
            const modelPoint = [-25, -15.0, -25.0];

            // Slice types and projected lines
            const sliceTypes = [niivue.SLICE_TYPE.AXIAL, niivue.SLICE_TYPE.CORONAL, niivue.SLICE_TYPE.SAGITTAL];
            sliceTypes.forEach((sliceType) => {
                const line = new niivue.ProjectedLineComponent({
                    modelPoints: [modelPoint],
                    targetComponent: labelText,
                    side: niivue.UIKit.componentSide.LEFT,
                    thickness: 10,
                    lineColor: lineColor,
                    terminator: niivue.UIKit.lineTerminator.ARROW,
                });
                line.tags = [sliceType.toString()];
                ui.addComponent(line);
            });

            // Additional lines for 3D
            const solidLineColor = [0.529, 0.808, 0.980, 1.0];
            const dottedLineColor = [0.529, 0.808, 0.980, 0.5];
            const line3DPre = new niivue.ProjectedLineComponent({
                modelPoints: [modelPoint],
                targetComponent: labelText,
                side: niivue.UIKit.componentSide.LEFT,
                thickness: 10,
                lineColor: solidLineColor,
                terminator: niivue.UIKit.lineTerminator.ARROW,
            });
            line3DPre.tags = ["3D_PRE"];
            ui.addComponent(line3DPre);

            const line3DPost = new niivue.ProjectedLineComponent({
                modelPoints: [modelPoint],
                targetComponent: labelText,
                side: niivue.UIKit.componentSide.LEFT,
                thickness: 10,
                lineColor: dottedLineColor,
                terminator: niivue.UIKit.lineTerminator.ARROW,
                lineStyle: niivue.UIKit.lineStyle.DOTTED,
                dashDotLength: 8,
            });
            line3DPost.tags = ["3D_POST"];
            ui.addComponent(line3DPost);

            nv1.drawScene();
        }

        // Niivue initialization
        const nv1 = new niivue.Niivue();
        nv1.opts.multiplanarShowRender = niivue.SHOW_RENDER.ALWAYS;
        nv1.setSliceType(nv1.sliceTypeMultiplanar);
        nv1.attachTo("gl1");

        const volumeList1 = [
            { url: "../images/mni152.nii.gz", colormap: "gray", visible: true, opacity: 1 },
            { url: "../images/hippo.nii.gz", colormap: "red", visible: true, opacity: 1 },
        ];
        await nv1.loadVolumes(volumeList1);

        const ui = nv1.ui;
        drawModelLines();
    </script>
</body>
</html>
