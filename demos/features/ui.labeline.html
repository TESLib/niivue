<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>Label Line</title>
    <link rel="stylesheet" href="light.css" />
</head>

<body>
    <noscript>
        <strong>niivue requires JavaScript.</strong>
    </noscript>
    <header>
        <select id="sliceType">
            <option value="0">Axial</option>
            <option value="1">Coronal</option>
            <option value="2">Sagittal</option>
            <option value="4">Render</option>
            <option value="3" selected>A+C+S+R</option>
        </select>
    </header>
    <main id="container">
        <canvas id="gl1"></canvas>
    </main>
    <footer id="location">&nbsp;</footer>
</body>

</html>

<script type="module" async>
    import * as niivue from "../dist/index.js";

    var drop = document.getElementById("sliceType");
    drop.onchange = function () {
        let st = parseInt(document.getElementById("sliceType").value);
        nv1.setSliceType(st);
    }

    function handleLocationChange(data) {
        document.getElementById("location").innerHTML =
            "&nbsp;&nbsp;" + data.string;
    }

    var volumeList1 = [
        {
            url: "../images/mni152.nii.gz",
            colormap: "gray",
            visible: true,
            opacity: 1
        },
        {
            url: "../images/hippo.nii.gz",
            colormap: "red",
            visible: true,
            opacity: 1
        }
    ];

    var nv1 = new niivue.Niivue({
        dragAndDropEnabled: true,
        onLocationChange: handleLocationChange,
    });

    nv1.attachTo("gl1");
    await nv1.loadVolumes(volumeList1);

    // Create an NVArcContainer instance
    const nvArcContainer = new niivue.NVArcContainer(niivue.NVAnchorPoint.TOPLEFT, niivue.NVAnchorPoint.BOTTOMRIGHT);

    // Define a list of labels with their corresponding 3D model positions
    const labels3D = [
        { text: 'Anterior Commissure', position: [0.0, 0.0, 0.0] },
        { text: 'Precentral Gyrus', position: [-42.0, -16.0, 54.0] },
        { text: 'Postcentral Gyrus', position: [38.0, -34.0, 50.0] },
        { text: 'Superior Temporal Gyrus', position: [60.0, -24.0, 6.0] },
        { text: 'Middle Temporal Gyrus', position: [-54.0, -44.0, 0.0] },
        { text: 'Inferior Parietal Lobule', position: [-56.0, -36.0, 40.0] },
        { text: 'Precuneus', position: [4.0, -64.0, 36.0] },
        { text: 'Cingulate Gyrus', position: [0.0, -12.0, 38.0] },
        { text: 'Hippocampus', position: [-28.0, -20.0, -12.0] },
        { text: 'Putamen', position: [28.0, 4.0, -2.0] },
        { text: 'Fornix', position: [0, -40, 0] }
    ];

    // Define a set of distinct colors for the labels
    const colors = [
        [1.0, 0.0, 0.0, 1.0], // Red
        [0.0, 1.0, 0.0, 1.0], // Green
        [0.0, 0.0, 1.0, 1.0], // Blue
        [1.0, 1.0, 0.0, 1.0], // Yellow
        [1.0, 0.0, 1.0, 1.0], // Magenta
        [0.0, 1.0, 1.0, 1.0], // Cyan
        [0.5, 0.5, 0.5, 1.0], // Gray
        [1.0, 0.5, 0.0, 1.0], // Orange
        [0.5, 0.0, 1.0, 1.0], // Purple
        [0.0, 1.0, 0.5, 1.0], // Light Green
    ];

    // Add each label with line to the container
    for (let i = 0; i < labels3D.length; i++) {
        const label = labels3D[i];

        // Assign a color from the set, cycling through if necessary
        const color = colors[i % colors.length];

        let labelLine = new niivue.NVLabelLine(
            nv1.gl, // WebGL context
            label.text, // Text for the label
            nv1.defaultFont, // Font used for the label
            [800, 600], // Initial 2D screen position (for alignment purposes)
            label.position, // 3D position of the label
            color, // Color of the line and text
            1.0, // Scale of the label
            10.0, // Thickness of the line
            0.1, // Hide depth
            [0.0, 0.0, 0.0, 0.3], // Background color (semi-transparent black)
            35, // Margin
            true, // isRenderedIn2D
            true // isRenderedIn3D
        );
        nvArcContainer.children.push(labelLine);
    }
    // Add the NVArcContainer to the uiComponents
    nv1.uiComponents.push(nvArcContainer);

    // Render the scene
    nv1.drawScene();
</script>